<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>  
  <title>WebNet - Search</title>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />  
  <style>  
    * { margin: 0; padding: 0; box-sizing: border-box; }  
    body {  
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
      background: linear-gradient(to bottom, #0d0d0d, #1a1a1a);  
      color: white;  
      min-height: 100vh;  
      display: flex;  
      flex-direction: column;  
      padding-bottom: 60px;  
    }  
    header {  
      padding: 20px;  
      text-align: center;  
      font-size: 1.5rem;  
      background: rgba(255, 255, 255, 0.05);  
      backdrop-filter: blur(8px);  
      border-bottom: 1px solid #333;  
    }  
    #searchBox {  
      margin: 20px auto;  
      width: 90%;  
      max-width: 400px;  
      display: flex;  
      flex-direction: column;  
      align-items: center;  
    }  
    input {  
      width: 100%;  
      padding: 10px 15px;  
      border-radius: 8px;  
      border: none;  
      outline: none;  
      font-size: 1rem;  
      background: #222;  
      color: #fff;  
      margin-bottom: 10px;  
    }  

    #results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 15px;
      margin-top: 20px;
      width: 100%;
      max-width: 400px;
    }

    .user-card {
      background: #232323;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.3s ease;
    }

    .user-card:hover {
      transform: translateY(-5px);
      background: #2e2e2e;
    }

    .user-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 10px;
      background: #444;
    }

    .avatar-placeholder {
      font-size: 50px;
      color: gray;
      margin-bottom: 10px;
    }

    .user-name {
      color: white;
      font-weight: bold;
      font-size: 1.1em;
      margin: 5px 0;
    }

    .user-username {
      color: #bbb;
      font-size: 0.9em;
    }

    nav {  
      position: fixed;  
      bottom: 0;  
      width: 100%;  
      background: #121212;  
      display: flex;  
      justify-content: space-around;  
      align-items: center;  
      padding: 10px 0;  
      border-top: 1px solid #333;  
      z-index: 10;  
    }  
    nav a {  
      color: white;  
      text-decoration: none;  
      text-align: center;  
      font-size: 1.2rem;  
    }  
    nav a i {  
      display: block;  
      font-size: 1.5rem;  
      margin-bottom: 5px;  
    }
  </style>  
</head>  
<body>  
  
  <header>Search Users</header>  
  
  <section id="searchBox">  
    <input type="text" id="searchInput" placeholder="Search users..." autocomplete="off" />  
    <div id="results"></div>  
  </section>  
  
  <nav>  
    <a href="home.html"><i class="fas fa-home"></i></a>  
    <a href="search.html"><i class="fas fa-search"></i></a>  
    <a href="profile.html"><i class="fas fa-user"></i></a>  
  </nav>  
  
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA6lvIUQ36aLbjomZnUqsIkkDgv017tcqI",
    authDomain: "webnet2.firebaseapp.com",
    projectId: "webnet2",
    storageBucket: "webnet2.firebasestorage.app",
    messagingSenderId: "323870835138",
    appId: "1:323870835138:web:bca571d5620b766651565b",
    databaseURL: "https://webnet2-default-rtdb.firebaseio.com"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const searchInput = document.getElementById("searchInput");
  const resultsDiv = document.getElementById("results");

  let debounceTimeout;
  const searchCache = new Map();

  function showLoading() {
    resultsDiv.innerHTML = `<p style="color:#aaa; text-align:center;">Loading...</p>`;
  }

  function clearResults() {
    resultsDiv.innerHTML = "";
  }

  searchInput.addEventListener("input", () => {
    clearTimeout(debounceTimeout);

    debounceTimeout = setTimeout(async () => {
      const searchTerm = searchInput.value.trim().toLowerCase();

      if (searchTerm === "") {
        clearResults();
        return;
      }

      if (searchCache.has(searchTerm)) {
        renderResults(searchCache.get(searchTerm));
        return;
      }

      showLoading();

      try {
        const dbRef = ref(db);
        const snapshot = await get(child(dbRef, "users"));

        if (!snapshot.exists()) {
          resultsDiv.textContent = "No users in database.";
          return;
        }

        const users = snapshot.val();
        const matches = [];

        Object.entries(users).forEach(([uid, user]) => {
          const { realName = "", username = "", profilePicture = "" } = user;
          if (
            realName.toLowerCase().includes(searchTerm) ||
            username.toLowerCase().includes(searchTerm)
          ) {
            matches.push({ uid, realName, username, profilePicture });
          }
        });

        searchCache.set(searchTerm, matches);

        renderResults(matches);
      } catch (error) {
        resultsDiv.textContent = "Error loading users.";
        console.error("Search error:", error);
      }
    }, 400); // debounce 400ms
  });

  function renderResults(matches) {
    clearResults();

    if (matches.length === 0) {
      resultsDiv.textContent = "No results found.";
      return;
    }

    matches.forEach(user => {
      const card = document.createElement("div");
      card.classList.add("user-card");

      if (user.profilePicture) {
        card.innerHTML = `
          <img src="${user.profilePicture}" class="user-avatar" alt="${user.realName}">
          <div class="user-name">${user.realName || "Unnamed"}</div>
          <div class="user-username">@${user.username || "unknown"}</div>
        `;
      } else {
        card.innerHTML = `
          <div class="avatar-placeholder"><i class="fas fa-user-circle"></i></div>
          <div class="user-name">${user.realName || "Unnamed"}</div>
          <div class="user-username">@${user.username || "unknown"}</div>
        `;
      }

      card.addEventListener("click", () => {
        window.location.href = `profile.html?uid=${user.uid}`;
      });

      resultsDiv.appendChild(card);
    });
  }
</script>
  
</body>  
</html>